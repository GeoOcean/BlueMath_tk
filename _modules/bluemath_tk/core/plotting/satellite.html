

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bluemath_tk.core.plotting.satellite &mdash; Bluemath-Toolkit  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/jupyter-sphinx.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/thebelab.css" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Bluemath-Toolkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">bluemath_tk</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Bluemath-Toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">bluemath_tk.core.plotting.satellite</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for bluemath_tk.core.plotting.satellite</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">EARTH_RADIUS</span>

<span class="n">EARTH_RADIUS_M</span> <span class="o">=</span> <span class="n">EARTH_RADIUS</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Convert km to m</span>


<div class="viewcode-block" id="deg2num">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.deg2num">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">deg2num</span><span class="p">(</span><span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts geographic coordinates to tile numbers for a given zoom level.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lat : float</span>
<span class="sd">        Latitude in degrees.</span>
<span class="sd">    lon : float</span>
<span class="sd">        Longitude in degrees.</span>
<span class="sd">    zoom : int</span>
<span class="sd">        Zoom level.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xtile : int</span>
<span class="sd">        Tile number in x-direction.</span>
<span class="sd">    ytile : int</span>
<span class="sd">        Tile number in y-direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">**</span><span class="n">zoom</span>
    <span class="n">xtile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">lon</span> <span class="o">+</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">360.0</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">ytile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
        <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">))</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">n</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">xtile</span><span class="p">,</span> <span class="n">ytile</span></div>



<div class="viewcode-block" id="num2deg">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.num2deg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">num2deg</span><span class="p">(</span><span class="n">xtile</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ytile</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts tile numbers back to geographic coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xtile : int</span>
<span class="sd">        Tile number in x-direction.</span>
<span class="sd">    ytile : int</span>
<span class="sd">        Tile number in y-direction.</span>
<span class="sd">    zoom : int</span>
<span class="sd">        Zoom level.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lat : float</span>
<span class="sd">        Latitude in degrees.</span>
<span class="sd">    lon : float</span>
<span class="sd">        Longitude in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">**</span><span class="n">zoom</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">xtile</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="mf">360.0</span> <span class="o">-</span> <span class="mf">180.0</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ytile</span> <span class="o">/</span> <span class="n">n</span><span class="p">)))</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span></div>



<div class="viewcode-block" id="lonlat_to_webmercator">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.lonlat_to_webmercator">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lonlat_to_webmercator</span><span class="p">(</span><span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts lon/lat to Web Mercator projection coordinates in meters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon : float</span>
<span class="sd">        Longitude in degrees.</span>
<span class="sd">    lat : float</span>
<span class="sd">        Latitude in degrees.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x : float</span>
<span class="sd">        X coordinate in meters.</span>
<span class="sd">    y : float</span>
<span class="sd">        Y coordinate in meters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">EARTH_RADIUS_M</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">EARTH_RADIUS_M</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>



<div class="viewcode-block" id="tile_bounds_meters">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.tile_bounds_meters">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tile_bounds_meters</span><span class="p">(</span>
    <span class="n">x_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the bounding box of the tile region in Web Mercator meters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x_start: int</span>
<span class="sd">        The starting x-coordinate of the tile.</span>
<span class="sd">    y_start: int</span>
<span class="sd">        The starting y-coordinate of the tile.</span>
<span class="sd">    x_end: int</span>
<span class="sd">        The ending x-coordinate of the tile.</span>
<span class="sd">    y_end: int</span>
<span class="sd">        The ending y-coordinate of the tile.</span>
<span class="sd">    zoom: int</span>
<span class="sd">        The zoom level of the tile.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xmin, ymin, xmax, ymax : float</span>
<span class="sd">        Bounding box in meters (Web Mercator projection).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">num2deg</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
    <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="n">num2deg</span><span class="p">(</span><span class="n">x_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">lonlat_to_webmercator</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">lonlat_to_webmercator</span><span class="p">(</span><span class="n">lon2</span><span class="p">,</span> <span class="n">lat1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span></div>



<div class="viewcode-block" id="calculate_zoom">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.calculate_zoom">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_zoom</span><span class="p">(</span>
    <span class="n">lon_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">display_width_px</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically estimates an appropriate zoom level for the bounding box.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon_min: float</span>
<span class="sd">        The minimum longitude of the bounding box.</span>
<span class="sd">    lon_max: float</span>
<span class="sd">        The maximum longitude of the bounding box.</span>
<span class="sd">    display_width_px: int</span>
<span class="sd">        The width of the display in pixels. Default is 1024.</span>
<span class="sd">    tile_size: int</span>
<span class="sd">        The size of the tile in pixels. Default is 256.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    zoom : int</span>
<span class="sd">        Estimated zoom level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">WORLD_MAP_WIDTH</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">EARTH_RADIUS_M</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lonlat_to_webmercator</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lonlat_to_webmercator</span><span class="p">(</span><span class="n">lon_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">region_width_m</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">meters_per_pixel_desired</span> <span class="o">=</span> <span class="n">region_width_m</span> <span class="o">/</span> <span class="n">display_width_px</span>
    <span class="n">zoom</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">WORLD_MAP_WIDTH</span> <span class="o">/</span> <span class="p">(</span><span class="n">tile_size</span> <span class="o">*</span> <span class="n">meters_per_pixel_desired</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">zoom</span><span class="p">))</span></div>



<div class="viewcode-block" id="get_cartopy_scale">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.get_cartopy_scale">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_cartopy_scale</span><span class="p">(</span><span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select appropriate cartopy feature scale based on zoom level.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    zoom : int</span>
<span class="sd">        Web Mercator zoom level.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    scale : str</span>
<span class="sd">        One of &#39;110m&#39;, &#39;50m&#39;, or &#39;10m&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">zoom</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;10m&quot;</span>
    <span class="k">elif</span> <span class="n">zoom</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;50m&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;110m&quot;</span></div>



<div class="viewcode-block" id="get_satellite_image">
<a class="viewcode-back" href="../../../../bluemath_tk.core.plotting.html#bluemath_tk.core.plotting.satellite.get_satellite_image">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_satellite_image</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">area</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">zoom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">display_width_px</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Downloads a satellite map for the given bounding box.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source: str</span>
<span class="sd">        The source of the satellite data.</span>
<span class="sd">    area: Tuple[float, float, float, float]</span>
<span class="sd">        The area of the satellite data.</span>
<span class="sd">    zoom: int</span>
<span class="sd">        The zoom level of the satellite data.</span>
<span class="sd">    display_width_px: int</span>
<span class="sd">        The width of the display in pixels.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    map_img : Image.Image</span>
<span class="sd">        The satellite map image.</span>
<span class="sd">    extent : Tuple[float, float, float, float]</span>
<span class="sd">        The extent of the satellite map (Web Mercator projection).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tile_size</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">area</span>
    <span class="k">if</span> <span class="n">zoom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="n">calculate_zoom</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">display_width_px</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">)</span>

    <span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span> <span class="o">=</span> <span class="n">deg2num</span><span class="p">(</span><span class="n">lat_max</span><span class="p">,</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
    <span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span> <span class="o">=</span> <span class="n">deg2num</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">x_end</span> <span class="o">-</span> <span class="n">x_start</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">y_end</span> <span class="o">-</span> <span class="n">y_start</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">map_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;arcgis&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="s2">&quot;https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">&quot;</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using Esri World Imagery (ArcGIS):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Free for public and non-commercial use</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Commercial use allowed under Esri terms of service</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Attribution required: &#39;Tiles © Esri — Sources: Esri, Earthstar Geographics, CNES/Airbus DS, &quot;</span>
            <span class="s2">&quot;USDA, USGS, AeroGRID, IGN, and the GIS User Community&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~19&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;google&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="s2">&quot;https://mt1.google.com/vt/lyrs=s&amp;x=</span><span class="si">{x}</span><span class="s2">&amp;y=</span><span class="si">{y}</span><span class="s2">&amp;z=</span><span class="si">{z}</span><span class="s2">&quot;</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">21</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using Google Maps Satellite:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- NOT license-free</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Usage outside official Google Maps SDKs/APIs is prohibited</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Commercial use requires a paid license from Google</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- May be blocked without an API key</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~21&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;eox&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="s2">&quot;https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2024_3857/default/g/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">.jpg&quot;</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using EOX Sentinel-2 Cloudless:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Based on Copernicus Sentinel-2 data processed by EOX</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Licensed under Creative Commons BY-NC-SA 4.0 (non-commercial use only)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Attribution required: &#39;Sentinel-2 cloudless – © EOX, based on modified Copernicus Sentinel data 2016–2024&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Versions from 2016–2017 are under CC BY 4.0 (commercial use allowed)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~16&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;osm&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="s2">&quot;https://tile.openstreetmap.org/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">.png&quot;</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using OpenStreetMap Standard Tiles:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Free and open-source (ODbL license)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Commercial use allowed with attribution</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Attribution required: &#39;© OpenStreetMap contributors&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~19&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;amazon&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://s3.amazonaws.com/elevation-tiles-prod/terrarium/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">.png&quot;</span>
        <span class="p">)</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using Amazon Terrarium Elevation Tiles:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Free for public use</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Attribution recommended: &#39;Amazon Terrarium&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~15&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;esri_world&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="s2">&quot;https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{y}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">&quot;</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using Esri World Imagery:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- High-resolution global imagery</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Free with attribution under Esri terms</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~19&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;geoportail_fr&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://data.geopf.fr/wmts?&quot;</span>
            <span class="s2">&quot;REQUEST=GetTile&amp;SERVICE=WMTS&amp;VERSION=1.0.0&quot;</span>
            <span class="s2">&quot;&amp;STYLE=normal&amp;TILEMATRIXSET=PM&amp;FORMAT=image/jpeg&quot;</span>
            <span class="s2">&quot;&amp;LAYER=ORTHOIMAGERY.ORTHOPHOTOS&amp;TILEMATRIX=</span><span class="si">{z}</span><span class="s2">&quot;</span>
            <span class="s2">&quot;&amp;TILEROW=</span><span class="si">{y}</span><span class="s2">&amp;TILECOL=</span><span class="si">{x}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using Geoportail France (Orthophotos):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Aerial orthophotos from the French National Institute (IGN)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Free for public use under Etalab license</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Attribution: Geoportail France / IGN</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~19&quot;</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;ign_spain_pnoa&quot;</span><span class="p">:</span>
        <span class="n">tile_url</span> <span class="o">=</span> <span class="s2">&quot;https://tms-pnoa-ma.idee.es/1.0.0/pnoa-ma/</span><span class="si">{z}</span><span class="s2">/</span><span class="si">{x}</span><span class="s2">/</span><span class="si">{y_inv}</span><span class="s2">.jpeg&quot;</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Using IGN Spain PNOA Orthophotos:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- High-resolution aerial imagery (PNOA program)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Provided by IGN/CNIG (Government of Spain)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Free to use under Creative Commons BY 4.0 license</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Attribution required: &#39;Ortofotografía PNOA – © IGN / CNIG (Gobierno de España) – CC BY 4.0&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- Max zoom ~19&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">zoom</span> <span class="o">&gt;</span> <span class="n">z_max</span><span class="p">:</span>
        <span class="n">zoom</span> <span class="o">=</span> <span class="n">z_max</span>

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">x_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_start</span><span class="p">,</span> <span class="n">y_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;ign_spain_pnoa&quot;</span><span class="p">:</span>
                <span class="n">y_inv</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">zoom</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">tile_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y_inv</span><span class="o">=</span><span class="n">y_inv</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">tile_url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">tile</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
                <span class="n">map_img</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span>
                    <span class="n">tile</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">tile_size</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching tile </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">tile_bounds_meters</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">x_end</span><span class="p">,</span> <span class="n">y_end</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">map_img</span><span class="p">,</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, GeoOcean Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>