

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bluemath_tk.core.operations &mdash; Bluemath-Toolkit  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/thebelab.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Bluemath-Toolkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">bluemath_tk</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Bluemath-Toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">bluemath_tk.core.operations</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for bluemath_tk.core.operations</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyproj</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">available_projections</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;SPAIN&quot;</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Proj</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s2">&quot;utm&quot;</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ellps</span><span class="o">=</span><span class="s2">&quot;WGS84&quot;</span><span class="p">),</span>
<span class="p">}</span>


<div class="viewcode-block" id="normalize">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.normalize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="n">custom_scale_factor</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize data to 0-1 using min max scaler approach.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : pd.DataFrame or xr.Dataset</span>
<span class="sd">        Input data to be normalized.</span>
<span class="sd">    custom_scale_factor : dict, optional</span>
<span class="sd">        Dictionary with variables as keys and a list with two values as</span>
<span class="sd">        values. The first value is the minimum and the second value is the</span>
<span class="sd">        maximum used to normalize the variable. If not provided, the</span>
<span class="sd">        minimum and maximum values of the variable are used.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        Logger object to log warnings if the custom min or max is bigger or</span>
<span class="sd">        lower than the datapoints.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    normalized_data : pd.DataFrame or xr.Dataset</span>
<span class="sd">        Normalized data.</span>
<span class="sd">    scale_factor : dict</span>
<span class="sd">        Dictionary with variables as keys and a list with two values as</span>
<span class="sd">        values. The first value is the minimum and the second value is the</span>
<span class="sd">        maximum used to normalize the variable.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This method does not modify the input data, it creates a copy of the</span>
<span class="sd">      dataframe / dataset and normalizes it.</span>
<span class="sd">    - The normalization is done variable by variable, i.e. the minimum and</span>
<span class="sd">      maximum values are calculated for each variable.</span>
<span class="sd">    - If custom min or max is bigger or lower than the datapoints, it will</span>
<span class="sd">      be changed to the minimum or maximum of the datapoints and a warning</span>
<span class="sd">      will be logged.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from bluemath_tk.core.operations import normalize</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(</span>
<span class="sd">    ...     {</span>
<span class="sd">    ...         &quot;Hs&quot;: np.random.rand(1000) * 7,</span>
<span class="sd">    ...         &quot;Tp&quot;: np.random.rand(1000) * 20,</span>
<span class="sd">    ...         &quot;Dir&quot;: np.random.rand(1000) * 360,</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; normalized_data, scale_factor = normalize(data=df)</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">    &gt;&gt;&gt; from bluemath_tk.core.operations import normalize</span>
<span class="sd">    &gt;&gt;&gt; ds = xr.Dataset(</span>
<span class="sd">    ...     {</span>
<span class="sd">    ...         &quot;Hs&quot;: ((&quot;time&quot;,), np.random.rand(1000) * 7),</span>
<span class="sd">    ...         &quot;Tp&quot;: ((&quot;time&quot;,), np.random.rand(1000) * 20),</span>
<span class="sd">    ...         &quot;Dir&quot;: ((&quot;time&quot;,), np.random.rand(1000) * 360),</span>
<span class="sd">    ...     },</span>
<span class="sd">    ...     coords={&quot;time&quot;: pd.date_range(&quot;2000-01-01&quot;, periods=1000)},</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; normalized_data, scale_factor = normalize(data=ds)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">vars_to_normalize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="n">vars_to_normalize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data must be a pandas DataFrame or an xarray Dataset&quot;</span><span class="p">)</span>

    <span class="n">normalized_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Copy data to avoid bad memory replacements</span>
    <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">custom_scale_factor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># Copy dict to avoid bad memory replacements</span>
    <span class="k">for</span> <span class="n">data_var</span> <span class="ow">in</span> <span class="n">vars_to_normalize</span><span class="p">:</span>
        <span class="n">data_var_min</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">data_var_max</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">custom_scale_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_var</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">custom_scale_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_var</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data_var_min</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Proposed min custom scaler for </span><span class="si">{</span><span class="n">data_var</span><span class="si">}</span><span class="s2"> is bigger than datapoint&quot;</span>  <span class="c1"># , using smallest datapoint</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Proposed min custom scaler for </span><span class="si">{</span><span class="n">data_var</span><span class="si">}</span><span class="s2"> is bigger than datapoint&quot;</span>  <span class="c1"># , using smallest datapoint</span>
                    <span class="p">)</span>
            <span class="c1">#     scale_factor[data_var][0] = data_var_min</span>
            <span class="c1"># else:</span>
            <span class="n">data_var_min</span> <span class="o">=</span> <span class="n">custom_scale_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_var</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">custom_scale_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_var</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">data_var_max</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Proposed max custom scaler for </span><span class="si">{</span><span class="n">data_var</span><span class="si">}</span><span class="s2"> is lower than datapoint&quot;</span>  <span class="c1"># , using biggest datapoint</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Proposed max custom scaler for </span><span class="si">{</span><span class="n">data_var</span><span class="si">}</span><span class="s2"> is lower than datapoint&quot;</span>  <span class="c1"># , using biggest datapoint</span>
                    <span class="p">)</span>
            <span class="c1">#     scale_factor[data_var][1] = data_var_max</span>
            <span class="c1"># else:</span>
            <span class="n">data_var_max</span> <span class="o">=</span> <span class="n">custom_scale_factor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_var</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_factor</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_var_min</span><span class="p">,</span> <span class="n">data_var_max</span><span class="p">]</span>
        <span class="n">normalized_data</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normalized_data</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_var_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">data_var_max</span> <span class="o">-</span> <span class="n">data_var_min</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">normalized_data</span><span class="p">,</span> <span class="n">scale_factor</span></div>



<div class="viewcode-block" id="denormalize">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.denormalize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">denormalize</span><span class="p">(</span>
    <span class="n">normalized_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Denormalize data using provided scale_factor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    normalized_data : pd.DataFrame or xr.Dataset</span>
<span class="sd">        Input data that has been normalized and needs to be denormalized.</span>
<span class="sd">    scale_factor : dict</span>
<span class="sd">        Dictionary with variables as keys and a list with two values as</span>
<span class="sd">        values. The first value is the minimum and the second value is the</span>
<span class="sd">        maximum used to denormalize the variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : pd.DataFrame or xr.Dataset</span>
<span class="sd">        Denormalized data.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This method does not modify the input data, it creates a copy of the</span>
<span class="sd">      dataframe / dataset and denormalizes it.</span>
<span class="sd">    - The denormalization is done variable by variable, i.e. the minimum and</span>
<span class="sd">      maximum values are used to scale the data back to its original range.</span>
<span class="sd">    - Assumes that the scale_factor dictionary contains appropriate min and</span>
<span class="sd">      max values for each variable in the normalized_data.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from bluemath_tk.core.operation import denormalize</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(</span>
<span class="sd">    ...     {</span>
<span class="sd">    ...         &quot;Hs&quot;: np.random.rand(1000),</span>
<span class="sd">    ...         &quot;Tp&quot;: np.random.rand(1000),</span>
<span class="sd">    ...         &quot;Dir&quot;: np.random.rand(1000),</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; scale_factor = {</span>
<span class="sd">    ...     &quot;Hs&quot;: [0, 7],</span>
<span class="sd">    ...     &quot;Tp&quot;: [0, 20],</span>
<span class="sd">    ...     &quot;Dir&quot;: [0, 360],</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; denormalized_data = denormalize(normalized_data=df, scale_factor=scale_factor)</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">    &gt;&gt;&gt; from bluemath_tk.core.operations import denormalize</span>
<span class="sd">    &gt;&gt;&gt; ds = xr.Dataset(</span>
<span class="sd">    ...     {</span>
<span class="sd">    ...         &quot;Hs&quot;: ((&quot;time&quot;,), np.random.rand(1000)),</span>
<span class="sd">    ...         &quot;Tp&quot;: ((&quot;time&quot;,), np.random.rand(1000)),</span>
<span class="sd">    ...         &quot;Dir&quot;: ((&quot;time&quot;,), np.random.rand(1000)),</span>
<span class="sd">    ...     },</span>
<span class="sd">    ...     coords={&quot;time&quot;: pd.date_range(&quot;2000-01-01&quot;, periods=1000)},</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; scale_factor = {</span>
<span class="sd">    ...     &quot;Hs&quot;: [0, 7],</span>
<span class="sd">    ...     &quot;Tp&quot;: [0, 20],</span>
<span class="sd">    ...     &quot;Dir&quot;: [0, 360],</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; denormalized_data = denormalize(normalized_data=ds, scale_factor=scale_factor)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">normalized_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">vars_to_denormalize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">normalized_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">normalized_data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="n">vars_to_denormalize</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">normalized_data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data must be a pandas DataFrame or an xarray Dataset&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">normalized_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Copy data to avoid bad memory replacements</span>
    <span class="k">for</span> <span class="n">data_var</span> <span class="ow">in</span> <span class="n">vars_to_denormalize</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="n">data_var</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale_factor</span><span class="p">[</span><span class="n">data_var</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">scale_factor</span><span class="p">[</span><span class="n">data_var</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">scale_factor</span><span class="p">[</span><span class="n">data_var</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="standarize">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.standarize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">standarize</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="n">scaler</span><span class="p">:</span> <span class="n">StandardScaler</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Standarize data to have mean 0 and std 1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray, pd.DataFrame or xr.Dataset</span>
<span class="sd">        Input data to be standarized.</span>
<span class="sd">    scaler : StandardScaler, optional</span>
<span class="sd">        Scaler object to use for standarization. Default is None.</span>
<span class="sd">    transform : bool</span>
<span class="sd">        Whether to just transform the data. Default to False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    standarized_data : np.ndarray, pd.DataFrame or xr.Dataset</span>
<span class="sd">        Standarized data.</span>
<span class="sd">    scaler : StandardScaler</span>
<span class="sd">        Scaler object used for standarization.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from bluemath_tk.core.operations import standarize</span>
<span class="sd">    &gt;&gt;&gt; data = np.random.rand(1000, 3) * 10.0</span>
<span class="sd">    &gt;&gt;&gt; standarized_data, scaler = standarize(data=data)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scaler</span> <span class="o">=</span> <span class="n">scaler</span> <span class="ow">or</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">standarized_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">standarized_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">var_name</span><span class="p">:</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="n">standarized_data</span><span class="p">[:,</span> <span class="n">i_var</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i_var</span><span class="p">,</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">coords</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">standarized_data</span><span class="p">,</span> <span class="n">scaler</span></div>



<div class="viewcode-block" id="destandarize">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.destandarize">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">destandarize</span><span class="p">(</span>
    <span class="n">standarized_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="n">scaler</span><span class="p">:</span> <span class="n">StandardScaler</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Destandarize data using provided scaler.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    standarized_data : np.ndarray, pd.DataFrame or xr.Dataset</span>
<span class="sd">        Standarized data to be destandarized.</span>
<span class="sd">    scaler : StandardScaler</span>
<span class="sd">        Scaler object used for standarization.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray, pd.DataFrame or xr.Dataset</span>
<span class="sd">        Destandarized data.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from bluemath_tk.core.data import standarize, destandarize</span>
<span class="sd">    &gt;&gt;&gt; data = np.random.rand(1000, 3) * 10.0</span>
<span class="sd">    &gt;&gt;&gt; standarized_data, scaler = standarize(data=data)</span>
<span class="sd">    &gt;&gt;&gt; data = destandarize(standarized_data=standarized_data, scaler=scaler)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standarized_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">standarized_data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standarized_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">standarized_data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">standarized_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">standarized_data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">standarized_data</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">var_name</span><span class="p">:</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">standarized_data</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">i_var</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i_var</span><span class="p">,</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">standarized_data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">coords</span><span class="o">=</span><span class="n">standarized_data</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="get_uv_components">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.get_uv_components">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_uv_components</span><span class="p">(</span><span class="n">x_deg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method calculates the u and v components for the given directional data.</span>

<span class="sd">    Here, we assume that the directional data is in degrees,</span>
<span class="sd">        beign 0° the North direction,</span>
<span class="sd">        and increasing clockwise.</span>

<span class="sd">                0° N</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">    270° W &lt;---------&gt; 90° E</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">                90° S</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x_deg : np.ndarray</span>
<span class="sd">        The directional data in degrees.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        The u and v components.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert degrees to radians and adjust by subtracting from π/2</span>
    <span class="n">x_rad</span> <span class="o">=</span> <span class="n">x_deg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>

    <span class="c1"># Calculate x and y components using cosine and sine</span>
    <span class="n">xu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_rad</span><span class="p">)</span>
    <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x_rad</span><span class="p">)</span>

    <span class="c1"># Return the u and v components</span>
    <span class="k">return</span> <span class="n">xu</span><span class="p">,</span> <span class="n">xv</span></div>



<div class="viewcode-block" id="get_degrees_from_uv">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.get_degrees_from_uv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_degrees_from_uv</span><span class="p">(</span><span class="n">xu</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xv</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method calculates the degrees from the u and v components.</span>

<span class="sd">    Here, we assume u and v represent angles between 0 and 360 degrees,</span>
<span class="sd">        where 0° is the North direction,</span>
<span class="sd">        and increasing clockwise.</span>

<span class="sd">                 (u=0, v=1)</span>
<span class="sd">                     |</span>
<span class="sd">                     |</span>
<span class="sd">    (u=-1, v=0) &lt;---------&gt; (u=1, v=0)</span>
<span class="sd">                     |</span>
<span class="sd">                     |</span>
<span class="sd">                 (u=0, v=-1)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xu : np.ndarray</span>
<span class="sd">        The u component.</span>
<span class="sd">    xv : np.ndarray</span>
<span class="sd">        The v component.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        The degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Calculate the degrees using the arctangent function</span>
    <span class="n">x_deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">xu</span><span class="p">,</span> <span class="n">xv</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">%</span> <span class="mi">360</span>

    <span class="c1"># Return the degrees</span>
    <span class="k">return</span> <span class="n">x_deg</span></div>



<div class="viewcode-block" id="convert_utm_to_lonlat">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.convert_utm_to_lonlat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_utm_to_lonlat</span><span class="p">(</span>
    <span class="n">utm_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">utm_y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method converts UTM coordinates to Longitude and Latitude.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    utm_x : np.ndarray</span>
<span class="sd">        The x values in UTM.</span>
<span class="sd">    utm_y : np.ndarray</span>
<span class="sd">        The y values in UTM.</span>
<span class="sd">    projection : int, str, dict, pyproj.CRS</span>
<span class="sd">        The projection to use for the transformation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        The longitude and latitude values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="n">available_projections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span>

    <span class="c1"># Transform the UTM to LonLat coordinates</span>
    <span class="n">reshape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">utm_x</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">utm_y</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">reshape_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">utm_y</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">utm_x</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">reshape</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">projection</span><span class="p">(</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reshape</span><span class="p">:</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">lon</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">reshape_size</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
            <span class="n">lat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">reshape_size</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># Return the LonLat coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></div>



<div class="viewcode-block" id="convert_lonlat_to_utm">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.convert_lonlat_to_utm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_lonlat_to_utm</span><span class="p">(</span>
    <span class="n">lon</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">lat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method converts Longitude and Latitude to UTM coordinates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon : np.ndarray</span>
<span class="sd">        The longitude values.</span>
<span class="sd">    lat : np.ndarray</span>
<span class="sd">        The latitude values.</span>
<span class="sd">    projection : int, str, dict, pyproj.CRS</span>
<span class="sd">        The projection to use for the transformation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        The x and y coordinates in UTM.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="n">available_projections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span>

    <span class="c1"># Transform the LonLat to UTM coordinates</span>
    <span class="n">reshape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">lon</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">lat</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">reshape_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">lon</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">reshape</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span> <span class="o">=</span> <span class="n">projection</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reshape</span><span class="p">:</span>
        <span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">utm_x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">reshape_size</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
            <span class="n">utm_y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">reshape_size</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># Return the UTM coordinates</span>
    <span class="k">return</span> <span class="n">utm_x</span><span class="p">,</span> <span class="n">utm_y</span></div>



<div class="viewcode-block" id="spatial_gradient">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.spatial_gradient">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">spatial_gradient</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate spatial gradient of a DataArray with dimensions (time, latitude, longitude).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : xr.DataArray</span>
<span class="sd">        Input data with dimensions (time, latitude, longitude).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.DataArray</span>
<span class="sd">        Gradient magnitude with same dimensions as input.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The gradient is calculated using central differences, accounting for</span>
<span class="sd">    latitude-dependent grid spacing in spherical coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Initialize gradient array</span>
    <span class="n">var_grad</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Get latitude values in radians for spherical coordinate correction</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="mf">180.0</span>

    <span class="c1"># Calculate gradients using vectorized operations</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
        <span class="n">var_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># calculate gradient (matrix)</span>
        <span class="n">m_c</span> <span class="o">=</span> <span class="n">var_val</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">var_val</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">var_val</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">var_val</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">var_val</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m_phi</span> <span class="o">=</span> <span class="n">lat_rad</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">dpx1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_c</span> <span class="o">-</span> <span class="n">m_l</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m_phi</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">dpx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_r</span> <span class="o">-</span> <span class="n">m_c</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m_phi</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">dpy1</span> <span class="o">=</span> <span class="n">m_c</span> <span class="o">-</span> <span class="n">m_d</span>
        <span class="n">dpy2</span> <span class="o">=</span> <span class="n">m_u</span> <span class="o">-</span> <span class="n">m_c</span>

        <span class="n">vg</span> <span class="o">=</span> <span class="p">(</span><span class="n">dpx1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dpx2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dpy1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dpy2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">var_grad</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vg</span>

    <span class="c1"># Set attributes</span>
    <span class="n">var_grad</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;m^2/s^2&quot;</span>
    <span class="n">var_grad</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Gradient&quot;</span>

    <span class="k">return</span> <span class="n">var_grad</span></div>



<div class="viewcode-block" id="nautical_to_mathematical">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.nautical_to_mathematical">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">nautical_to_mathematical</span><span class="p">(</span><span class="n">nautical_degrees</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert nautical degrees (0° at North, clockwise) to</span>
<span class="sd">    mathematical degrees (0° at East, counterclockwise)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nautical_degrees : np.ndarray</span>
<span class="sd">        Directional angle in nautical convention</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        Directional angle in mathematical convention</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert nautical degrees to mathematical degrees</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">nautical_degrees</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span></div>



<div class="viewcode-block" id="mathematical_to_nautical">
<a class="viewcode-back" href="../../../bluemath_tk.core.html#bluemath_tk.core.operations.mathematical_to_nautical">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mathematical_to_nautical</span><span class="p">(</span><span class="n">math_degrees</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert mathematical degrees (0° at East, counterclockwise) to</span>
<span class="sd">    nautical degrees (0° at North, clockwise)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    math_degrees : float or array-like</span>
<span class="sd">        Directional angle in mathematical convention</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        Directional angle in nautical convention</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert mathematical degrees to nautical degrees</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">math_degrees</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, GeoOcean Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>